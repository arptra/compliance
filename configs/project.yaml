input:
  input_dir: "data/raw"
  file_glob: "*.xlsx"
  file_names: null  # optional explicit list, e.g. ["2025-01.xlsx", "2025_02_part1.xlsx"]
  month_source: "column"  # legacy, training now relies on datetime filter from excel column
  month_regex: "(\\d{4})[-_](\\d{2})"
  month_regexes: null
  month_column: "created_at"
  month_column_datetime_format: "%Y-%m-%d %H:%M:%S"
  datetime_column: "created_at"
  datetime_format: "%Y-%m-%d %H:%M:%S"
  id_column: null
  signal_columns: ["dialog_text", "call_text", "comment_text", "summary_text", "subject", "channel", "product", "status"]
  dialog_column: "dialog_text"  # legacy fallback
  dialog_columns: ["dialog_text", "call_text", "comment_text", "summary_text"]
  encoding: "utf-8"

client_first_extraction:
  enabled: true
  client_markers: ["CLIENT", "КЛИЕНТ", "ПОЛЬЗОВАТЕЛЬ", "USER"]
  operator_markers: ["OPERATOR", "ОПЕРАТОР", "АГЕНТ", "SUPPORT"]
  chatbot_markers: ["CHATBOT", "БОТ", "ASSISTANT", "ROBOT"]
  stop_on_markers: ["OPERATOR", "ОПЕРАТОР", "CHATBOT", "БОТ", "SUPPORT", "АГЕНТ"]
  fallback_mode: "first_paragraph"
  fallback_first_n_chars: 600
  min_client_len: 20
  take_second_client_if_too_short: true

pii:
  enabled: true
  replace_email: "<EMAIL>"
  replace_phone: "<PHONE>"
  replace_url: "<URL>"
  replace_card: "<CARD>"
  replace_account: "<ACCOUNT>"

llm:
  enabled: true
  mode: "mtls"
  base_url: "https://gigachat.devices.sberbank.ru/api/v1"
  ca_bundle_file: "certs/ca.pem"
  cert_file: "certs/client.pem"
  key_file: "certs/client.key"
  key_file_password_env: "GIGACHAT_KEY_PASSWORD"
  verify_ssl_certs: true
  model: "GigaChat"
  max_workers: 8
  batch_size: 20
  max_text_chars: 1200
  cache_db: "data/interim/gigachat_cache.sqlite"
  prompt_version: "v1"

prepare:
  pilot_month: null
  pilot_limit: 5000
  date_from: null
  date_to: null
  output_parquet: "data/processed/all_prepared.parquet"
  pilot_parquet: "data/processed/pilot_prepared.parquet"
  pilot_review_xlsx: "exports/pilot_review.xlsx"

training:
  text_field: "client_first_message"
  complaint_threshold: 0.5
  vectorizer:
    word_ngram: [1, 2]
    char_ngram: [3, 5]
    max_features_word: 200000
    max_features_char: 120000
    min_df: 5
    max_df: 0.6
  classifier:
    complaint: "logreg"
    category: "linearsvc"
  validation:
    split_mode: "time"
    val_month: null
    val_from: null
    val_to: null
  model_dir: "models"

analysis:
  novelty:
    enabled: true
    method: "kmeans_distance"
    svd_components: 200
    kmeans_k: 40
    threshold_percentile: 98
    min_cluster_size: 20
  reports_dir: "reports"

files:
  deny_tokens_path: "configs/deny_tokens.txt"
  extra_stopwords_path: "configs/extra_stopwords.txt"
  categories_seed_path: "configs/categories_seed.yaml"
