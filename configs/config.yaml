input:
  path: "data/sample.xlsx"
  baseline_paths: []
  december_path: null
  december_paths: []

  message_col: "message"
  message_cols: null
  date_col: "date"
  date_format: null
  month_col: null

  role_parsing:
    enabled: true
    client_markers: ["CLIENT", "КЛИЕНТ", "ПОЛЬЗОВАТЕЛЬ", "USER"]
    operator_markers: ["OPERATOR", "ОПЕРАТОР", "АГЕНТ", "SUPPORT"]
    chatbot_markers: ["CHATBOT", "БОТ", "ROBOT", "ASSISTANT"]
    client_prefix_regexes:
      - "(?im)^\\s*(CLIENT|КЛИЕНТ|ПОЛЬЗОВАТЕЛЬ|USER)\\s*[:\\-\\]]\\s*"
      - "(?im)^\\s*\\[(CLIENT|КЛИЕНТ|ПОЛЬЗОВАТЕЛЬ|USER)\\]\\s*"
    stop_on_markers: ["OPERATOR", "ОПЕРАТОР", "CHATBOT", "БОТ", "SUPPORT", "АГЕНТ"]
    fallback_mode: "first_paragraph"
    fallback_first_n_chars: 400

  baseline:
    mode: "last_n_months"
    n_months: 6
    start: null
    end: null
    filter_col: null
    filter_value: null

  december:
    mode: "month_value"
    month_value: "2025-12"
    start: null
    end: null
    filter_col: null
    filter_value: null

preprocess:
  lemmatize: false
  use_razdel: true
  remove_placeholders: true
  placeholder_patterns:
    - "<[^>]{1,80}>"
    - "\\*{2,}"
    - "(?i)\\b(x{2,}|х{2,}|_+|#+|!num!|!fio!)\\b"
    - "\\b\\d{4,}\\b"
    - "\\b[0-9a-f]{8,}\\b"
    - "\\b[0-9a-f]{8}-[0-9a-f-]{8,}\\b"
    - "(?i)\\b(ticket|case|id|uuid|guid)\\b\\s*[:=]?\\s*\\w+"
  remove_urls_emails_phones: true
  normalize_numbers: "remove"
  number_token: "<num>"
  keep_cyrillic_latin_only: true
  min_token_len: 3
  max_token_len: 30
  drop_tokens_with_digits: true
  drop_tokens_with_underscores: true
  drop_repeated_char_tokens: true
  extra_stopwords_path: "configs/extra_stopwords.txt"
  deny_tokens_path: "configs/deny_tokens.txt"

vectorizer:
  token_pattern: null
  ngram_range: [1, 2]
  min_df: 5
  max_df: 0.5
  max_features: 200000

clustering:
  model: "minibatch_kmeans"   # minibatch_kmeans | kmeans | birch
  n_clusters: 30
  batch_size: 4096
  birch_threshold: 0.5
  birch_branching_factor: 50
  top_terms: 12
  examples_per_cluster: 8

summaries:
  top_terms_per_cluster: 12
  examples_per_cluster: 8
  use_ctfidf: true
  always_filter_top_terms: true

pilot:
  complaint_mode: "weak_train"  # rules_only | weak_train
  n_clusters: 20
  sample_per_cluster: 10
  complaint_examples: 30
  save_models: false

stages:
  require_pilot_approval: true
  approval_file: "reports/pilot_approval.txt"

complaint:
  model: "logreg"
  threshold: 0.5
  seed_min_confidence: "strong_only"

novelty:
  percentile: 2
  novel_december_subclusters: 8
  examples_per_novel_cluster: 10
  emerging_terms_topn: 30
  emerging_terms_min_df: 10
  december_complaint_subclusters: 8

output:
  keep_full_raw_text: true
  raw_text_col_name: "message_raw"
  analyzed_text_col_name: "message_client_first"
  labeled_baseline_xlsx: "outputs/labeled_baseline.xlsx"
  labeled_december_xlsx: "outputs/labeled_december.xlsx"
  combined_xlsx: "outputs/combined_labeled.xlsx"
  report_md: "reports/report.md"
  model_dir: "models"

random_state: 42
logging_level: "INFO"
